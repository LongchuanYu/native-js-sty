<head>
  <meta charset="UTF-8">
  <style>
    #container {
        position: relative;
    }
    #container canvas {
        position: absolute;
    }
    #container #imageCanvas {
        z-index: 0;
        border: 1px dashed lightgray;
    }
    #container #drawingCanvas {
        z-index: 1;
    }
  </style>
</head>

<body>
<pre>
  1. 画线
</pre>
<!--<button onclick="console.log(lineArray)">info</button>-->
<div id="container">
  <canvas id="imageCanvas"
          width="700"
          height="600"></canvas>
  <canvas id="drawingCanvas"
          width="700"
          height="600"></canvas>
</div>

<script>
    var img = document.getElementById("imageCanvas");
    var draw = document.getElementById("drawingCanvas")
    var imgCtx = img.getContext('2d')
    var drawCtx = img.getContext('2d')
    var imgData = new Image()

    var lastCkX = 0
    var lastCkY = 0

    var drawList = []

    window.onload = function(e) {
        drawCtx.lineCap='round';
        drawCtx.strokeStyle = 'red'
        drawCtx.lineWidth = 1.6
        imgData.src = 'assets/1.jpg'
        imgData.onload = function() {
            imgCtx.drawImage(imgData,0,0,img.width,img.height)
        }
        draw.oncontextmenu = function(e) {
            e.preventDefault()
        }

    }

    draw.onmousedown = function(e) {

        lastCkX = e.offsetX
        lastCkY = e.offsetY
        // redrawEdge()
        drawList.push([lastCkX,lastCkY])

    }

    draw.onmousemove = function(e) {
        if (!drawList.length) return
        let edge = new Path2D()
        drawCtx.clearRect(0, 0, img.width, img.height)
        redrawImg()
        redrawEdge()
        let [x,y] = drawList[drawList.length-1]
        edge.moveTo(x,y)
        edge.lineTo(e.offsetX,e.offsetY)
        drawCtx.stroke(edge)
    }

    function redrawImg() {
        imgCtx.clearRect(0, 0, img.width, img.height)
        imgCtx.drawImage(imgData, 0, 0, img.width, img.height)
    }
    function redrawEdge() {
        let paths = new Path2D()
        let edge = new Path2D()
        if (drawList.length) {
            // 不是第一次点击划线
            for(let i=0;i<drawList.length-1; i++) {
                let c = drawList[i]
                let n = drawList[i+1]
                edge.moveTo(c[0],c[1])
                edge.lineTo(n[0],n[1])
                paths.addPath(edge)

            };
            drawCtx.stroke(paths)
        }
    }


</script>
</body>
